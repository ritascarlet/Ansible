# üöÄ Remnawave Ansible Infrastructure

[![License: Beerware](https://img.shields.io/badge/License-Beerware-orange.svg)](https://spdx.org/licenses/Beerware.html)
[![Ansible](https://img.shields.io/badge/Ansible-2.17%2B-red.svg)](https://www.ansible.com/)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](CONTRIBUTING.md)

## üìñ –û –ø—Ä–æ–µ–∫—Ç–µ

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π Remnawave —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ansible. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–∞–ø–ª–µ–π–±—É–∫ –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `new`.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–∞–ø–ª–µ–π–±—É–∫** (`remnanode.yaml`)
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É** (`status: new`)
- ‚úÖ **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –±–∞–∑–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã)
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (vpnuser —Å SSH-–∫–ª—é—á–∞–º–∏)
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** (fail2ban, firewall, SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- ‚úÖ **Remnanode —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** (VDS + DNS)
- ‚úÖ **Selfsteal —Å–µ—Ä–≤–∏—Å—ã** (Caddy + Docker)
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Zabbix Agent 2)
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (Graylog)
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º** (Teleport Machine ID)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ ansible.cfg              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible
‚îú‚îÄ‚îÄ remnanode.yaml           # –ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–∞–ø–ª–µ–π–±—É–∫
‚îú‚îÄ‚îÄ playbooks/               # –ù–∞–±–æ—Ä—ã –∑–∞–¥–∞—á –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ prepare-system/      # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ user-create/         # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ fail2ban-install/    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ fail2ban
‚îÇ   ‚îú‚îÄ‚îÄ firewall/            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
‚îÇ   ‚îú‚îÄ‚îÄ ssh-settings/        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SSH
‚îÇ   ‚îú‚îÄ‚îÄ remnanode/           # –°–æ–∑–¥–∞–Ω–∏–µ Remnanode VDS
‚îÇ   ‚îú‚îÄ‚îÄ remnanode-dns/       # DNS –∑–∞–ø–∏—Å–∏ Remnawave
‚îÇ   ‚îú‚îÄ‚îÄ remnanode-selfsteal/ # Selfsteal —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ zabbix-install/      # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Zabbix
‚îÇ   ‚îú‚îÄ‚îÄ graylog/             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Graylog
‚îÇ   ‚îî‚îÄ‚îÄ teleport-install/    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º Teleport
‚îî‚îÄ‚îÄ README.md
```

## üõ† –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üéØ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–∞–ø–ª–µ–π–±—É–∫**
–ï–¥–∏–Ω—ã–π –ø–ª–µ–π–±—É–∫ `remnanode.yaml` –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `new`
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (`serial: 1`)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### üîß **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã**
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —É—Ç–∏–ª–∏—Ç
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### üë§ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**
–°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ `vpnuser`
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-–∫–ª—é—á–µ–π
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è

### üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤:
- **Fail2ban** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- **Firewall** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª iptables
- **SSH** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SSH

### üåê **Remnanode –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Remnanode —Å–µ—Ä–≤–∏—Å–æ–≤:
- –°–æ–∑–¥–∞–Ω–∏–µ VDS –Ω–æ–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ DNS –∑–∞–ø–∏—Å–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Selfsteal —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ Caddy

### üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
- **Zabbix Agent 2** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
- **Graylog** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Teleport** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
```yaml
all:
  children:
    servers:
      hosts:
        your-server:
          ansible_host: 1.2.3.4
          ansible_user: root
          ansible_port: 22
          server_name: your-server
          status: new  # ‚Üê –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
          ansible_password: your-password
          os_name: Ubuntu
          host_provider: YourProvider
          location: Germany
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Semaphore UI
–ù–∞—Å—Ç—Ä–æ–π —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `vpnuser_pubkey` ‚Äî SSH –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è vpnuser
- `zabbix_server_fqdn` ‚Äî FQDN —Å–µ—Ä–≤–µ—Ä–∞ Zabbix
- `zabbix_api_token` ‚Äî —Ç–æ–∫–µ–Ω API Zabbix
- `teleport_proxy` ‚Äî –∞–¥—Ä–µ—Å –ø—Ä–æ–∫—Å–∏ Teleport
- `teleport_ca_pin` ‚Äî PIN —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ CA

### 3. –ó–∞–ø—É—Å–∫
```bash
ansible-playbook remnanode.yaml
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **Ansible Vault** –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ **SSH-–∫–ª—é—á–∏** —Ö—Ä–∞–Ω—è—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ
- ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è `status: new`
- ‚úÖ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚Äî `serial: 1`
- ‚úÖ **Teleport Machine ID** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ansible 2.17+
- Python 3.8+
- –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –ø–æ SSH
- Semaphore UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Beerware License ‚Äî –µ—Å–ª–∏ –º—ã –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è, –∏ —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è —ç—Ç–æ—Ç –∫–æ–¥, –∫—É–ø–∏ –º–Ω–µ –ø–∏–≤–æ üòé
